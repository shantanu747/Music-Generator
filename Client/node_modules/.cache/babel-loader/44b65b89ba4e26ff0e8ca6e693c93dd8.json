{"ast":null,"code":"!function (t, e) {\n  \"object\" == typeof exports && \"object\" == typeof module ? module.exports = e() : \"function\" == typeof define && define.amd ? define([], e) : \"object\" == typeof exports ? exports.index = e() : t.index = e();\n}(self, function () {\n  return function (t) {\n    var e = {};\n\n    function i(s) {\n      if (e[s]) return e[s].exports;\n      var n = e[s] = {\n        i: s,\n        l: !1,\n        exports: {}\n      };\n      return t[s].call(n.exports, n, n.exports, i), n.l = !0, n.exports;\n    }\n\n    return i.m = t, i.c = e, i.d = function (t, e, s) {\n      i.o(t, e) || Object.defineProperty(t, e, {\n        enumerable: !0,\n        get: s\n      });\n    }, i.r = function (t) {\n      \"undefined\" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(t, Symbol.toStringTag, {\n        value: \"Module\"\n      }), Object.defineProperty(t, \"__esModule\", {\n        value: !0\n      });\n    }, i.t = function (t, e) {\n      if (1 & e && (t = i(t)), 8 & e) return t;\n      if (4 & e && \"object\" == typeof t && t && t.__esModule) return t;\n      var s = Object.create(null);\n      if (i.r(s), Object.defineProperty(s, \"default\", {\n        enumerable: !0,\n        value: t\n      }), 2 & e && \"string\" != typeof t) for (var n in t) i.d(s, n, function (e) {\n        return t[e];\n      }.bind(null, n));\n      return s;\n    }, i.n = function (t) {\n      var e = t && t.__esModule ? function () {\n        return t.default;\n      } : function () {\n        return t;\n      };\n      return i.d(e, \"a\", e), e;\n    }, i.o = function (t, e) {\n      return Object.prototype.hasOwnProperty.call(t, e);\n    }, i.p = \"\", i(i.s = 4);\n  }([function (t, e, i) {\n    \"use strict\";\n\n    i.r(e), i.d(e, \"SVGNS\", function () {\n      return s;\n    }), i.d(e, \"drawSVGPath\", function () {\n      return n;\n    }), i.d(e, \"drawSVGText\", function () {\n      return r;\n    }), i.d(e, \"createSVGGroupChild\", function () {\n      return a;\n    }), i.d(e, \"setFade\", function () {\n      return h;\n    });\n    const s = \"http://www.w3.org/2000/svg\";\n\n    function n(t, e, i, n, r, a, h = 1) {\n      const l = document.createElementNS(s, \"path\");\n      return l.setAttributeNS(null, \"d\", e), l.setAttributeNS(null, \"transform\", \"translate(\".concat(i, \", \").concat(n, \") scale(\").concat(r, \", \").concat(a, \")\")), l.setAttributeNS(null, \"opacity\", \"\".concat(h)), t.appendChild(l), l;\n    }\n\n    function r(t, e, i, n, r, a = !1, h = 1, l = 1) {\n      const c = document.createElementNS(s, \"text\");\n      c.setAttributeNS(null, \"font-family\", \"Times\"), c.setAttributeNS(null, \"font-size\", r), a && c.setAttributeNS(null, \"font-weight\", \"bold\"), c.setAttributeNS(null, \"transform\", \"translate(\".concat(i, \", \").concat(n, \") scale(\").concat(h, \", \").concat(l, \")\"));\n      const o = document.createTextNode(e);\n      return c.appendChild(o), t.appendChild(c), c;\n    }\n\n    function a(t, e) {\n      const i = document.createElementNS(s, \"g\");\n      return i.setAttribute(\"data-id\", e), t.appendChild(i), i;\n    }\n\n    function h(t, e = !1, i = 1, n = 0) {\n      let r = t.querySelector(\"animate\");\n\n      if (!r) {\n        (r = document.createElementNS(s, \"animate\")).setAttributeNS(null, \"attributeName\", \"opacity\"), r.setAttributeNS(null, \"dur\", \"4s\"), r.setAttributeNS(null, \"fill\", \"freeze\"), r.setAttributeNS(null, \"keyTimes\", \"0; 0.25; 0.5; 0.75; 1\");\n        const t = (i + 3 * n) / 4;\n        r.setAttributeNS(null, \"values\", \"\".concat(i, \"; \").concat(t, \"; \").concat(n, \"; \").concat(t, \"; \").concat(i));\n      }\n\n      return e ? r.setAttributeNS(null, \"repeatCount\", \"indefinite\") : r.setAttributeNS(null, \"repeatCount\", \"1\"), t.appendChild(r), t;\n    }\n  }, function (t, e, i) {\n    \"use strict\";\n\n    i.r(e), i.d(e, \"PATH_SCALE\", function () {\n      return s;\n    }), i.d(e, \"staffLinePath\", function () {\n      return r;\n    }), i.d(e, \"extraLinePath\", function () {\n      return a;\n    }), i.d(e, \"barPath\", function () {\n      return h;\n    }), i.d(e, \"stemPath\", function () {\n      return l;\n    }), i.d(e, \"singleFlagPath\", function () {\n      return c;\n    }), i.d(e, \"multiFlagPath\", function () {\n      return o;\n    }), i.d(e, \"tiePath\", function () {\n      return u;\n    }), i.d(e, \"dotPath\", function () {\n      return d;\n    }), i.d(e, \"NOTE_PATHS\", function () {\n      return f;\n    }), i.d(e, \"REST_PATHS\", function () {\n      return g;\n    }), i.d(e, \"CLEF_PATHS\", function () {\n      return S;\n    }), i.d(e, \"ACCIDENTAL_PATHS\", function () {\n      return p;\n    });\n    const s = 100,\n          n = \"M 0,10 C 0,-15 35,-50 80,-50 110,-50 125,-35 125,-10 \\n125,15 90,50 45,50 15,50 0,35 0,10 Z\",\n          r = \"m 0,0 h 100\",\n          a = \"m -25,0 h 175\",\n          h = \"m 0,-200 v 400\",\n          l = \"m 0,0 v 100 h 15 v -100 z\",\n          c = \"M0,0 h 12 c 7,100 175,156 62,314 79,-177 -49,\\n-193 -61,-200 l -13,-5 z\",\n          o = \"m 0,0 h 10 c 6,72 173,64 84,227 44,-120 -44,\\n-123 -94,-167 z\",\n          u = \"M 0,25 C 10,46 30,67 50,67 69,67 90,47 100,25 94,\\n65 73,89 50,89 26,89 5,63 0,25 Z\",\n          d = \"M 5 -20 a 20 20 0 1 0 0.00001 0 z\",\n          f = {\n      4: {\n        path: \"m 0,0 c 0,-37 49,-51 79,-51 31,0 83,13 83,51 0,39 \\n-55,51 -84,51 C 49,51 0,37 0,0 Z m 111,31 c 13,-19 0,-58 -22,-68 -33,-15 \\n-53,10 -39,49 9,27 48,39 61,19 z\",\n        width: 150,\n        stemVSteps: 0,\n        stemAnchor: 0,\n        flags: 0\n      },\n      2: {\n        path: \"m 0,10 c 0,-25 35,-60 80,-60 15,0 45,4 45,40 C 125,16 \\n89,50 45,50 17,50 0,36 0,10 Z m 71,7 c 17,-11 45,-34 38,-45 -7,-10 -39,1 \\n-57,12 -19,11 -42,31 -36,42 6,10 37,2 55,-9 z\",\n        width: 125,\n        stemVSteps: 7,\n        stemAnchor: -10,\n        flags: 0\n      },\n      1: {\n        path: n,\n        width: 125,\n        stemVSteps: 7,\n        stemAnchor: -10,\n        flags: 0\n      },\n      .5: {\n        path: n,\n        width: 125,\n        stemVSteps: 7,\n        stemAnchor: -10,\n        flags: 1\n      },\n      .25: {\n        path: n,\n        width: 125,\n        stemVSteps: 9,\n        stemAnchor: -10,\n        flags: 2\n      },\n      .125: {\n        path: n,\n        width: 125,\n        stemVSteps: 11,\n        stemAnchor: -10,\n        flags: 3\n      },\n      .0625: {\n        path: n,\n        width: 125,\n        stemVSteps: 13,\n        stemAnchor: -10,\n        flags: 4\n      }\n    },\n          g = {\n      4: \"m 0,-50 h 125 v -50 H 0 Z\",\n      2: \"M 0,0 H 125 V -50 H 0 Z\",\n      1: \"m 0,-25 c 39,-39 37,-75 8,-120 l 6,-5 61,103 C \\n40,-13 31,4 73,71 l -5,5 C 14,52 16,125 67,144 l -4,6 C -37,102 -1,22 59,60 Z\",\n      .5: \"m 52,-47 c 26,-2 42,-21 48,-42 l 12,4 L 64,83 52,79 \\n88,-49 c 0,0 -17,22 -57,22 -16,0 -31,-13 -31,-27 0,-18 10,-31 27,-31 17,0 \\n33,15 25,38 z\",\n      .25: \"m 129,-191 c -6,21 -22,40 -48,42 8,-23 -8,-38 \\n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -20,69 \\nc -7,18 -22,33 -45,35 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 15,27 \\n31,27 40,0 57,-22 57,-22 l -36,128 12,4 77,-270 z\",\n      .125: \"m 129,-191 c -6,21 -22,40 -48,42 8,-23 -8,-38 \\n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -20,69 \\nc -7,18 -22,33 -45,35 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 15,27 \\n31,27 40,0 57,-22 57,-22 L 68,20 C 61,37 46,51 24,52 32,29 16,14 -1,14 c \\n-17,0 -27,13 -27,31 0,14 15,27 31,27 38,0 55,-20 57,-22 l -36,128 12,4 \\n105,-369 z\",\n      .0625: \"m 158,-292 c -6,21 -22,40 -48,42 8,-23 -8,-38 \\n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -17,61 \\nv 0 c -6,21 -22,40 -48,42 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 \\n15,27 31,27 40,0 57,-22 57,-22 l -20,69 c -7,18 -22,33 -45,35 8,-23 -8,-38 \\n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 L 68,20 C \\n61,37 46,51 24,52 32,29 16,14 -1,14 c -17,0 -27,13 -27,31 0,14 15,27 31,27 \\n38,0 55,-20 57,-22 l -36,128 12,4 134,-469 z\"\n    },\n          S = {\n      50: {\n        path: \"m 101,-199 c -49,0 -100,28 -100,83 0,39 58,57 82,26 15,-20 \\n-4,-47 -32,-47 -23,1 -25,0 -25,-8 0,-22 40,-46 71,-41 91,16 67,208 -105,302 \\n75,-27 198,-94 211,-201 6,-66 -42,-114 -102,-114 z m 143,33 c -13,0 -23,11 \\n-23,24 0,14 10,24 23,24 13,0 23,-11 23,-24 0,-13 -10,-24 -23,-24 z m 2,83 c \\n-13,0 -23,11 -23,24 0,14 10,24 23,24 13,0 23,-11 23,-24 0,-13 -10,-24 -23,-24 \\nz\",\n        upper: -4,\n        lower: 3\n      },\n      71: {\n        path: \"M 139,48 C 102,57 76,120 131,151 41,128 64,24 129,2 L \\n117,-57 C -32,47 26,217 166,182 Z m 12,-1 27,131 C 242,153 216,46 151,47 \\nZ m -35,-177 c 34,-23 82,-117 50,-140 -23,-17 -71,33 -50,140 z m -10,10 c \\n-23,-77 -20,-200 48,-213 19,-4 89,171 -26,266 l 13,66 c 120,-6 137,155 \\n39,191 l 12,58 c 30,131 -137,145 -138,47 0,-29 37,-59 63,-37 21,18 25,71 \\n-25,70 32,42 103,0 91,-65 L 167,193 C 56,232 -112,63 106,-120 Z\",\n        upper: -7,\n        lower: 8\n      }\n    },\n          p = [null, \"m -49,-121 v 52 l -29,9 v -48 h -8 v 51 l -20,6 v 29 l \\n20,-6 v 70 l -20,6 v 30 l 20,-6 v 51 h 8 V 69 l 30,-8 v 50 h 8 V 58 l 20,-6 \\nV 23 l -20,6 v -71 l 20,-6 v -29 l -20,6 v -50 z m 1,82 v 71 l -29,9 v -71 z\", \"M -106,-166 V 67 c 52,-42 85,-56 85,-94 0,-47 -46,-51 \\n-73,-22 v -117 z m 31,120 c 20,0 42,46 -20,91 V -7 c 0,-28 10,-39 20,-39 z\", \"m -81,-58 v -48 H -92 V 73 l 60,-13 v 50 h 11 V -72 Z m \\n50,24 v 58 l -50,11 v -58 z\"];\n  }, function (t, e, i) {\n    \"use strict\";\n\n    i.r(e), i.d(e, \"MIN_RESOLUTION\", function () {\n      return s;\n    }), i.d(e, \"STEM_WIDTH\", function () {\n      return n;\n    }), i.d(e, \"LINE_STROKE\", function () {\n      return r;\n    }), i.d(e, \"COMPACT_SPACING\", function () {\n      return a;\n    });\n    const s = .0625,\n          n = 15,\n          r = 1,\n          a = 150;\n  }, function (t, e, i) {\n    \"use strict\";\n\n    i.r(e), i.d(e, \"MAX_QUARTER_DIVISION\", function () {\n      return l;\n    }), i.d(e, \"ScrollType\", function () {\n      return c;\n    }), i.d(e, \"StaffSVGRender\", function () {\n      return o;\n    });\n    var s = i(2),\n        n = i(0),\n        r = i(1);\n    const a = [{\n      steps: [0, 0, -1, -1, -2, -3, -3, -4, -4, -5, -5, -6],\n      accidental: [0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0]\n    }, {\n      steps: [0, -1, -1, -2, -2, -3, -4, -4, -5, -5, -6, -6],\n      accidental: [0, 0, 3, 0, 3, 0, 0, 3, 0, 3, 0, 3]\n    }, {\n      steps: [0, 0, -1, -1, -2, -3, -3, -4, -4, -5, -5, -6],\n      accidental: [3, 0, 0, 1, 0, 3, 0, 0, 1, 0, 1, 0]\n    }, {\n      steps: [0, -1, -1, -2, -2, -3, -4, -4, -5, -5, -6, -6],\n      accidental: [0, 2, 0, 0, 3, 0, 2, 0, 0, 3, 0, 3]\n    }, {\n      steps: [0, 0, -1, -1, -2, -3, -3, -4, -4, -5, -5, -6],\n      accidental: [3, 0, 3, 0, 0, 3, 0, 3, 0, 0, 1, 0]\n    }, {\n      steps: [0, -1, -1, -2, -2, -3, -4, -4, -5, -5, -6, -6],\n      accidental: [0, 2, 0, 2, 0, 0, 2, 0, 2, 0, 0, 3]\n    }, {\n      steps: [0, -1, -1, -2, -2, -3, -4, -4, -5, -5, -6, -7],\n      accidental: [3, 0, 3, 0, 3, 0, 0, 3, 0, 3, 0, 0]\n    }, {\n      steps: [0, 0, -1, -1, -2, -3, -3, -4, -4, -5, -5, -6],\n      accidental: [0, 1, 0, 1, 0, 3, 0, 0, 1, 0, 1, 0]\n    }, {\n      steps: [0, -1, -1, -2, -2, -3, -4, -4, -5, -5, -6, -6],\n      accidental: [0, 0, 3, 0, 3, 0, 2, 0, 0, 3, 0, 3]\n    }, {\n      steps: [0, 0, -1, -1, -2, -3, -3, -4, -4, -5, -5, -6],\n      accidental: [3, 0, 0, 1, 0, 3, 0, 3, 0, 0, 1, 0]\n    }, {\n      steps: [0, -1, -1, -2, -2, -3, -4, -4, -5, -5, -6, -6],\n      accidental: [0, 2, 0, 0, 3, 0, 2, 0, 2, 0, 0, 3]\n    }, {\n      steps: [0, 0, -1, -1, -2, -3, -3, -4, -4, -5, -5, -6],\n      accidental: [3, 0, 3, 0, 0, 3, 0, 3, 0, 3, 0, 0]\n    }],\n          h = [{\n      accidental: 1,\n      pitches: []\n    }, {\n      accidental: 2,\n      pitches: [70, 75, 68, 73, 66]\n    }, {\n      accidental: 1,\n      pitches: [78, 73]\n    }, {\n      accidental: 2,\n      pitches: [70, 75, 68]\n    }, {\n      accidental: 1,\n      pitches: [78, 73, 80, 75]\n    }, {\n      accidental: 2,\n      pitches: [70]\n    }, {\n      accidental: 2,\n      pitches: [70, 75, 68, 73, 66, 71]\n    }, {\n      accidental: 1,\n      pitches: [78]\n    }, {\n      accidental: 2,\n      pitches: [70, 75, 68, 73]\n    }, {\n      accidental: 1,\n      pitches: [78, 73, 80]\n    }, {\n      accidental: 2,\n      pitches: [70, 75]\n    }, {\n      accidental: 1,\n      pitches: [78, 73, 80, 75, 70]\n    }],\n          l = 16;\n    var c;\n    !function (t) {\n      t[t.PAGE = 0] = \"PAGE\", t[t.NOTE = 1] = \"NOTE\", t[t.BAR = 2] = \"BAR\";\n    }(c || (c = {}));\n\n    class o {\n      constructor(t, e, i) {\n        this.handleScrollEvent = t => {\n          this.lastKnownScrollLeft = this.parentElement.scrollLeft, this.ticking || window.requestAnimationFrame(() => {\n            this.changeAndDrawSignaturesIfNeeded(this.lastKnownScrollLeft), this.ticking = !1;\n          }), this.ticking = !0;\n        }, this.scoreInfo = t;\n        this.config = {\n          noteHeight: e.noteHeight || 6,\n          noteSpacing: e.noteSpacing || 1,\n          pixelsPerTimeStep: e.pixelsPerTimeStep || 30,\n          noteRGB: e.noteRGB || \"8, 41, 64\",\n          activeNoteRGB: e.activeNoteRGB || \"240, 84, 119\"\n        }, this.div = i, this.timeSignatureNumerator = 4, this.timeSignatureDenominator = 4, this.key = e.defaultKey || 0, this.scrollType = e.scrollType || c.PAGE, this.scale = this.config.noteHeight / r.PATH_SCALE, (void 0 === e.pixelsPerTimeStep || e.pixelsPerTimeStep <= 0) && (this.config.pixelsPerTimeStep = 0, this.config.noteSpacing = s.COMPACT_SPACING * this.scale), this.clear(), this.redraw();\n      }\n\n      clear() {\n        for (; this.div.lastChild;) this.div.removeChild(this.div.lastChild);\n\n        this.div.style.overflow = \"visible\", this.div.style.position = \"relative\", this.overlaySVG = document.createElementNS(n.SVGNS, \"svg\"), this.overlaySVG.style.position = \"absolute\", this.div.appendChild(this.overlaySVG), this.overlayG = Object(n.createSVGGroupChild)(this.overlaySVG, \"overlay\"), this.signaturesBlinking = !1, this.signaturesQuarters = 0, this.parentElement = document.createElement(\"div\"), this.parentElement.style.overflow = \"auto\", this.div.appendChild(this.parentElement), this.ticking = !1, this.lastKnownScrollLeft = 0, this.parentElement.addEventListener(\"scroll\", this.handleScrollEvent), this.staffSVG = document.createElementNS(n.SVGNS, \"svg\"), this.parentElement.appendChild(this.staffSVG), this.staffG = Object(n.createSVGGroupChild)(this.staffSVG, \"staff\"), this.linesG = Object(n.createSVGGroupChild)(this.staffSVG, \"lines\"), this.setStroke(this.linesG), this.staffG.appendChild(this.linesG), this.musicG = Object(n.createSVGGroupChild)(this.staffSVG, \"music\"), this.setFill(this.musicG), this.setStroke(this.musicG, 0), this.staffG.appendChild(this.musicG), this.signaturesG = Object(n.createSVGGroupChild)(this.staffSVG, \"signatures\"), this.staffG.appendChild(this.signaturesG);\n        let t = 0,\n            e = 0;\n        this.scoreInfo.notes.forEach(i => {\n          t += i.pitch, ++e;\n        });\n        const i = t / e;\n        this.clef = i < 60 ? 50 : 71, this.signaturesList = [{\n          x: 0,\n          q: 0\n        }], this.signatureCurrent = 0, this.signatureNext = 0, this.changeKeySignatureIfNeeded(0), this.changeTimeSignatureIfNeeded(0), this.vStepSize = this.config.noteHeight / 2, this.hStepSize = this.config.pixelsPerTimeStep, this.staffOffset = 0, this.height = 0, this.width = 0, this.musicBlockMap = new Map(), this.playingNotes = [], this.lastBar = 0, this.barAccidentals = {}, this.lastQ = -1;\n      }\n\n      isPaintingActiveNote(t, e) {\n        const i = t.start === e.start,\n              s = t.start <= e.start && t.start + t.length >= e.start + e.length;\n        return i || s;\n      }\n\n      redraw(t, e) {\n        let i = -1;\n        const s = 0 === this.config.pixelsPerTimeStep;\n\n        if (t) {\n          const r = [];\n          this.playingNotes.forEach(e => {\n            this.isPaintingActiveNote(e, t) ? r.push(e) : this.highlightElement(this.getGroup(e), !1);\n          }), this.playingNotes = r;\n          const a = this.getGroup(t);\n\n          if (a) {\n            this.playingNotes.push(t), this.highlightElement(a, !0), i = a.getBoundingClientRect().left - this.staffSVG.getBoundingClientRect().left;\n            const r = t.start,\n                  h = a.getAttribute(\"data-is-bar-beginning\");\n            (this.scrollType !== c.BAR || h) && this.scrollIntoViewIfNeeded(e, i), !s && this.signaturesBlinking && r >= this.signaturesQuarters && (this.signaturesBlinking = !1, Object(n.setFade)(this.overlayG, this.signaturesBlinking));\n          }\n        } else {\n          this.setDetails();\n          const t = -1 === this.lastQ;\n          let e = 0,\n              i = 0;\n          t ? (i = this.drawSignatures(this.overlayG, e, !0, !0, !0), s && (this.width = 0, i += this.config.noteSpacing), i += this.drawRests(this.initialRest, e + i)) : e = this.width, this.musicBlockMap.forEach((t, n) => {\n            s || (e = this.quartersToTime(n) * this.hStepSize), n > this.lastQ ? (i += this.drawMusicBlock(t, e + i), this.lastQ = n) : n === this.lastQ && (i += this.drawRests(t, e + i));\n          });\n          const n = this.staffSVG.getBoundingClientRect(),\n                r = this.musicG.getBoundingClientRect();\n          if (this.updateVerticalBoundaries(r.top - n.top, r.bottom - n.top), s) this.width += i;else {\n            const t = this.musicBlockMap.get(this.lastQ),\n                  e = this.quartersToTime(this.lastQ + t.notes[0].length);\n            this.width = e * this.config.pixelsPerTimeStep;\n          }\n          this.staffSVG.setAttributeNS(null, \"width\", \"\".concat(this.width)), this.redrawStaff(this.linesG, 0, this.width);\n        }\n\n        return i;\n      }\n\n      drawMusicBlock(t, e) {\n        const i = t.notes[0].start;\n        let a = this.drawBarIfNeeded(i, e);\n        a += this.drawSignaturesIfNeeded(i, e + a);\n        let h = 0;\n\n        for (let e = 4; e >= s.MIN_RESOLUTION && !h; e /= 2) e <= t.notes[0].length && (h = e);\n\n        if (0 === h) {\n          const e = 0 === t.notes[0].length ? \"[infinite]\" : \"\".concat(4 / t.notes[0].length);\n          console.warn(\" StaffRender \", \"background:orange; color:white\", \"StaffRender does not handle notes shorther than \" + \"1/\".concat(4 / s.MIN_RESOLUTION, \"th, and this score tries to draw a \") + \"1/\".concat(e, \"th. Shortest possible note will be drawn instead.\")), h = s.MIN_RESOLUTION;\n        }\n\n        const l = r.NOTE_PATHS[h];\n        let c;\n\n        if (l.stemAnchor && (c = Object(n.createSVGGroupChild)(this.musicG, \"stem\")), t.notes.forEach(i => {\n          const s = i.vSteps * this.vStepSize,\n                c = 2 * (i.vSteps > 0 ? Math.floor(i.vSteps / 2) : Math.ceil(i.vSteps / 2)),\n                o = i.vSteps > 0 ? -2 : 2;\n\n          for (let t = c; Math.abs(t) > 4; t += o) Object(n.drawSVGPath)(this.linesG, r.extraLinePath, e + a, t * this.vStepSize, this.scale, 1);\n\n          if (i.g = i.tiedFrom ? i.tiedFrom.g : Object(n.createSVGGroupChild)(this.musicG, \"\".concat(i.start, \"-\").concat(i.pitch)), t.isBarBeginning && i.g.setAttribute(\"data-is-bar-beginning\", \"true\"), i.tiedFrom) {\n            const t = e + a - i.tiedFrom.xHeadRight;\n            Object(n.drawSVGPath)(i.g, r.tiePath, i.tiedFrom.xHeadRight, s, t / r.PATH_SCALE, this.scale * (i.vSteps < 0 ? -1 : 1), i.opacity);\n          }\n\n          Object(n.drawSVGPath)(i.g, l.path, e + a, s, this.scale, this.scale, i.opacity), i.xHeadRight = e + a + l.width * this.scale, 1.5 * h <= i.length && Object(n.drawSVGPath)(i.g, r.dotPath, e + a + l.width * this.scale + this.vStepSize / 2, s - this.vStepSize / 2, this.scale, this.scale, i.opacity), 0 !== i.accidental && Object(n.drawSVGPath)(i.g, r.ACCIDENTAL_PATHS[i.accidental], e + a, s, this.scale, this.scale, i.opacity);\n        }), l.stemAnchor) {\n          let i,\n              h,\n              o = e + a;\n          const u = l.stemAnchor * this.scale,\n                d = t.minVStep + t.maxVStep < 0,\n                f = l.flags > 2 ? 2 * (l.flags - 2) : 0;\n          if (d ? (i = t.maxVStep * this.vStepSize - u, h = (t.minVStep + 7 + f) * this.vStepSize) : (o += (l.width - s.STEM_WIDTH) * this.scale, i = t.minVStep * this.vStepSize + u, h = (t.maxVStep - 7 - f) * this.vStepSize), Object(n.drawSVGPath)(c, r.stemPath, o, i, this.scale, (h - i) / r.PATH_SCALE), 1 === l.flags) Object(n.drawSVGPath)(c, r.singleFlagPath, o, h, this.scale, this.scale * (d ? -1 : 1), 1);else if (l.flags > 1) for (let t = 0; t < l.flags; ++t) Object(n.drawSVGPath)(c, r.multiFlagPath, o, h, this.scale, this.scale * (d ? -1 : 1), 1), h += (d ? -2 : 2) * this.vStepSize;\n        }\n\n        return 0 === this.config.pixelsPerTimeStep && (a += l.width * this.scale, c && (a += c.getBoundingClientRect().width), a += this.config.noteSpacing), a += this.drawRests(t, e + a);\n      }\n\n      drawBarIfNeeded(t, e) {\n        let i = 0;\n        const s = this.lastBar + this.getBarLength();\n        return 0 !== t && t >= s && (this.config.pixelsPerTimeStep > 0 ? e -= this.config.noteSpacing : i = this.config.noteSpacing, Object(n.drawSVGPath)(this.linesG, r.barPath, e, 0, 1, this.scale), this.lastBar = s), i;\n      }\n\n      drawRests(t, e) {\n        let i = 0,\n            a = t.restToNextLength;\n\n        if (a) {\n          this.config.pixelsPerTimeStep > 0 && (e += this.quartersToTime(t.notes[0].length) * this.hStepSize);\n          let h = t.notes[0].start + t.notes[0].length,\n              l = 0;\n          const c = this.lastBar + this.getBarLength() - h;\n          let o;\n\n          for (a > c && (l = a - c, a = c), o = 4; o > this.getBarLength() && o >= s.MIN_RESOLUTION; o /= 2);\n\n          let u = o;\n\n          for (; (a || l) && u >= s.MIN_RESOLUTION;) {\n            if (u <= a) {\n              i += this.drawBarIfNeeded(h, e + i), i += this.drawSignaturesIfNeeded(h, e + i);\n              const t = Object(n.drawSVGPath)(this.musicG, r.REST_PATHS[u], e + i, 0, this.scale, this.scale);\n              this.config.pixelsPerTimeStep > 0 ? e += this.quartersToTime(u) * this.hStepSize : (i += t.getBoundingClientRect().width, i += this.config.noteSpacing), h += u, a -= u;\n            }\n\n            if (l && a <= 0) {\n              const t = this.getBarLength();\n\n              for (l > t ? (a = t, l -= t) : (a = l, l = 0), o = 4; o > this.getBarLength() && o >= s.MIN_RESOLUTION; o /= 2);\n\n              u = o;\n            }\n\n            a < u && (u /= 2);\n          }\n        }\n\n        return i;\n      }\n\n      redrawStaff(t, e, i) {\n        let s = t.querySelector('g[data-id=\"staff-five-lines\"]');\n        if (s) s.setAttributeNS(null, \"transform\", \"scale(\".concat(i / r.PATH_SCALE, \", 1)\"));else {\n          s = Object(n.createSVGGroupChild)(t, \"staff-five-lines\");\n          const a = 0;\n\n          for (let t = -4; t <= 4; t += 2) Object(n.drawSVGPath)(s, r.staffLinePath, e, a + t * this.vStepSize, i / r.PATH_SCALE, 1);\n        }\n        return s;\n      }\n\n      clearSignatureOverlay() {\n        for (; this.overlayG.lastChild;) this.overlayG.removeChild(this.overlayG.lastChild);\n      }\n\n      drawSignaturesIfNeeded(t, e) {\n        let i = 0;\n        const r = this.changeKeySignatureIfNeeded(t),\n              a = this.changeTimeSignatureIfNeeded(t);\n\n        if (r || a) {\n          const h = s.COMPACT_SPACING * this.scale * (this.config.pixelsPerTimeStep > 0 ? 3 : 2);\n          this.signaturesList.push({\n            x: e - h,\n            q: t\n          }), null === this.signatureNext && (this.signatureNext = e);\n          const l = t > 0 ? Object(n.createSVGGroupChild)(this.signaturesG, \"signatures\") : this.overlayG;\n          i += this.drawSignatures(l, e + i, !1, r, a);\n        }\n\n        return 0 === this.config.pixelsPerTimeStep ? i : 0;\n      }\n\n      drawSignatures(t, e, i, a, l) {\n        const c = s.COMPACT_SPACING * this.scale;\n        let o,\n            u = c;\n        const d = t === this.overlayG || this.config.pixelsPerTimeStep > 0;\n\n        if (d) {\n          (o = document.createElementNS(n.SVGNS, \"rect\")).setAttributeNS(null, \"x\", \"\".concat(e)), o.setAttributeNS(null, \"y\", \"0\"), o.setAttributeNS(null, \"width\", \"1\"), o.setAttributeNS(null, \"height\", \"1\"), o.setAttribute(\"data-id\", \"background\"), t.appendChild(o);\n          const i = document.defaultView.getComputedStyle(this.div.parentElement);\n          o.setAttributeNS(null, \"fill\", i.getPropertyValue(\"background-color\"));\n        }\n\n        if (i) {\n          const i = Object(n.drawSVGPath)(t, r.CLEF_PATHS[this.clef].path, e + u, 0, this.scale, this.scale);\n          this.setFill(i), u += 3 * c;\n        }\n\n        if (a) {\n          const i = h[this.key].accidental,\n                s = 71 === this.clef ? 0 : 14;\n          h[this.key].pitches.forEach(a => {\n            const h = this.getPitchDetails(a).vSteps,\n                  l = Object(n.drawSVGPath)(t, r.ACCIDENTAL_PATHS[i], e + u, (s + h) * this.vStepSize, this.scale, this.scale);\n            this.setFill(l), u += l.getBoundingClientRect().width;\n          });\n        }\n\n        if (l) {\n          const i = Object(n.createSVGGroupChild)(t, \"time-key\"),\n                s = \"\".concat(2.85 * this.config.noteHeight, \"px\");\n          Object(n.drawSVGText)(i, \"\".concat(this.timeSignatureNumerator), e + u, -.5, s, !0), Object(n.drawSVGText)(i, \"\".concat(this.timeSignatureDenominator), e + u, 4 * this.vStepSize - .5, s, !0), this.setFill(i), u += i.getBoundingClientRect().width + c;\n        }\n\n        const f = this.redrawStaff(t, e, u);\n        this.setStroke(f);\n        const g = this.div.getBoundingClientRect(),\n              S = t.getBoundingClientRect();\n\n        if (this.updateVerticalBoundaries(S.top - g.top, S.bottom - g.top), d && (o.setAttributeNS(null, \"y\", \"\".concat(-this.staffOffset)), o.setAttributeNS(null, \"height\", \"\".concat(this.height)), o.setAttributeNS(null, \"width\", \"\".concat(u))), t === this.overlayG) {\n          this.overlaySVG.setAttributeNS(null, \"width\", \"\".concat(u + 5));\n\n          for (let e = 0; e < 5; ++e) {\n            const i = Object(n.drawSVGPath)(t, r.stemPath, u + e, e * e - this.staffOffset, 1 / s.STEM_WIDTH, (this.height - 2 * e * e) / r.PATH_SCALE, (e - 5) * (e - 5) * 2 / r.PATH_SCALE);\n            this.setFill(i);\n          }\n        }\n\n        if (this.config.pixelsPerTimeStep > 0) {\n          const i = 0 === this.signaturesQuarters;\n          return i && (this.signaturesQuarters = this.timeToQuarters(u / this.hStepSize)), (i || e > 0) && (this.signaturesBlinking = !0, Object(n.setFade)(t, this.signaturesBlinking)), 0;\n        }\n\n        return u;\n      }\n\n      changeKeySignatureIfNeeded(t) {\n        if (this.scoreInfo.keySignatures) {\n          let e = this.key;\n\n          for (let i = 0; i < this.scoreInfo.keySignatures.length && this.scoreInfo.keySignatures[i].start <= t; ++i) e = this.scoreInfo.keySignatures[i].key;\n\n          if (e !== this.key) return this.key = e, !0;\n        }\n\n        return !1;\n      }\n\n      changeTimeSignatureIfNeeded(t) {\n        if (this.scoreInfo.timeSignatures) {\n          let e = this.timeSignatureNumerator,\n              i = this.timeSignatureDenominator;\n\n          for (let s = 0; s < this.scoreInfo.timeSignatures.length && this.scoreInfo.timeSignatures[s].start <= t; ++s) e = this.scoreInfo.timeSignatures[s].numerator, i = this.scoreInfo.timeSignatures[s].denominator;\n\n          if (e !== this.timeSignatureNumerator || i !== this.timeSignatureDenominator) return this.timeSignatureNumerator = e, this.timeSignatureDenominator = i, !0;\n        }\n\n        return !1;\n      }\n\n      changeAndDrawSignaturesIfNeeded(t) {\n        let e;\n\n        if (t < this.signatureCurrent || null !== this.signatureNext && this.signatureNext <= t) {\n          e = this.signaturesList[0].q, this.signatureNext = null;\n\n          for (let i = 0; i < this.signaturesList.length; ++i) {\n            if (t < this.signaturesList[i].x) {\n              this.signatureNext = this.signaturesList[i].x;\n              break;\n            }\n\n            this.signatureCurrent = this.signaturesList[i].x, e = this.signaturesList[i].q;\n          }\n        }\n\n        if (void 0 !== e) {\n          const t = this.key,\n                i = this.timeSignatureNumerator,\n                s = this.timeSignatureDenominator;\n          this.changeKeySignatureIfNeeded(e), this.changeTimeSignatureIfNeeded(e), this.clearSignatureOverlay(), this.drawSignatures(this.overlayG, 0, !0, !0, !0), this.key = t, this.timeSignatureNumerator = i, this.timeSignatureDenominator = s;\n        }\n\n        this.config.pixelsPerTimeStep > 0 && 0 === t && (this.signatureNext = 0, this.signaturesBlinking = !0, Object(n.setFade)(this.overlayG, this.signaturesBlinking));\n      }\n\n      getBarLength() {\n        return 4 * this.timeSignatureNumerator / this.timeSignatureDenominator;\n      }\n\n      scrollIntoViewIfNeeded(t, e) {\n        if (t) if (this.scrollType === c.PAGE) {\n          const t = this.parentElement.getBoundingClientRect().width;\n          e > this.parentElement.scrollLeft + t && (this.parentElement.scrollLeft = e - 20);\n        } else {\n          const t = this.parentElement.getBoundingClientRect().width;\n          this.parentElement.scrollLeft = e - .5 * t;\n        }\n      }\n\n      updateVerticalBoundaries(t, e) {\n        let i = 0;\n\n        if (t < 0) {\n          this.staffOffset -= t;\n          const e = \"translate(0, \".concat(this.staffOffset, \")\");\n          this.overlayG.setAttributeNS(null, \"transform\", e), this.staffG.setAttributeNS(null, \"transform\", e), i = this.height - t;\n        }\n\n        if ((i = Math.max(i, e - t)) > this.height) {\n          this.height = i, this.overlaySVG.setAttributeNS(null, \"height\", \"\".concat(this.height)), this.staffSVG.setAttributeNS(null, \"height\", \"\".concat(this.height));\n          const t = this.div.querySelectorAll('rect[data-id=\"background\"]');\n\n          for (let e = 0; e < t.length; ++e) {\n            const i = t[e];\n            i.setAttributeNS(null, \"y\", \"\".concat(-this.staffOffset)), i.setAttributeNS(null, \"height\", \"\".concat(this.height));\n          }\n        }\n      }\n\n      setFill(t, e = !1) {\n        t.setAttributeNS(null, \"fill\", this.getColor(e));\n      }\n\n      setStroke(t, e = s.LINE_STROKE, i = !1) {\n        t.setAttributeNS(null, \"stroke\", this.getColor(i)), t.setAttributeNS(null, \"stroke-width\", \"\".concat(e));\n      }\n\n      getColor(t) {\n        return \"rgb(\".concat(t ? this.config.activeNoteRGB : this.config.noteRGB, \")\");\n      }\n\n      getOpacity(t) {\n        return t ? t / 127 * .8 + .2 : 1;\n      }\n\n      getGroup(t) {\n        const e = t.start,\n              i = t.pitch;\n        return this.staffSVG.querySelector(\"g[data-id=\\\"\".concat(e, \"-\").concat(i, \"\\\"]\"));\n      }\n\n      highlightElement(t, e) {\n        t.setAttribute(\"fill\", this.getColor(e)), t.setAttribute(\"stroke\", this.getColor(e));\n      }\n\n      getBarBeginnings() {\n        const t = new Set();\n        let e = 0;\n        this.scoreInfo.notes.forEach(t => {\n          t.start + t.length > e && (e = t.start + t.length);\n        });\n        const i = this.scoreInfo.timeSignatures ? this.scoreInfo.timeSignatures.slice(0) : [{\n          start: 0,\n          numerator: 4,\n          denominator: 4\n        }];\n        i.sort((t, e) => t.start - e.start);\n        let s = 0;\n\n        for (let n = 0; n < i.length; ++n) {\n          const r = n === i.length - 1 ? e : i[n].start,\n                a = 4 * i[n].numerator / i[n].denominator;\n\n          for (; s < r; s += a) t.add(s);\n        }\n\n        return t;\n      }\n\n      quartersToTime(t) {\n        return t / this.scoreInfo.tempos[0].qpm * 60;\n      }\n\n      timeToQuarters(t) {\n        return t * this.scoreInfo.tempos[0].qpm / 60;\n      }\n\n      setDetails() {\n        let t = new Map();\n        const e = this.getBarBeginnings(),\n              i = new Set(e);\n        this.scoreInfo.notes.slice().sort((t, e) => t.start - e.start).forEach(e => {\n          const s = this.getQNote(e);\n          i.add(s.start), i.add(s.start + s.length), t.has(s.start) ? t.get(s.start).push(s) : t.set(s.start, [s]);\n        }), Array.from(i).sort((t, e) => t - e).forEach(e => {\n          const i = [];\n          t.forEach(t => {\n            t.forEach(t => {\n              const s = this.splitQNote(t, e);\n              s && i.push(s);\n            });\n          }), i.forEach(e => {\n            t.has(e.start) ? t.get(e.start).push(e) : t.set(e.start, [e]);\n          });\n        }), t = new Map(Array.from(t).sort((t, e) => t[0] - e[0]));\n        const s = this.key;\n        let n = null,\n            r = 0;\n        const a = e[Symbol.iterator]();\n        let h = a.next();\n        t.forEach((t, e) => {\n          const i = {\n            maxVStep: Number.MAX_SAFE_INTEGER,\n            minVStep: Number.MIN_SAFE_INTEGER,\n            restToNextLength: 0,\n            isBarBeginning: !1,\n            notes: []\n          };\n          this.changeKeySignatureIfNeeded(e);\n          const s = h.value + this.getBarLength();\n          !h.done && e >= s && (h = a.next(), this.barAccidentals = {}, i.isBarBeginning = !0), t.forEach(t => {\n            this.analyzePitch(t, e), i.minVStep = Math.max(t.vSteps, i.minVStep), i.maxVStep = Math.min(t.vSteps, i.maxVStep), i.notes.push(t);\n          }), n && (n.restToNextLength = e - r), this.musicBlockMap.set(e, i), n = i, r = e + i.notes[0].length;\n        }), this.initialRest = {\n          maxVStep: 0,\n          minVStep: 0,\n          restToNextLength: this.musicBlockMap.values().next().value.notes[0].start,\n          isBarBeginning: !0,\n          notes: [{\n            start: 0,\n            length: 0,\n            vSteps: 0,\n            accidental: 0,\n            opacity: 0,\n            pitch: 0,\n            xHeadRight: 0\n          }]\n        }, this.key = s;\n      }\n\n      getQNote(t) {\n        return {\n          start: t.start,\n          length: t.length,\n          vSteps: 0,\n          accidental: 0,\n          opacity: this.getOpacity(t.intensity),\n          pitch: t.pitch,\n          xHeadRight: 0\n        };\n      }\n\n      splitQNote(t, e) {\n        const i = t.start + t.length - e;\n        return e > t.start && i > 0 ? (t.length -= i, {\n          start: e,\n          length: i,\n          vSteps: t.vSteps,\n          accidental: t.accidental,\n          opacity: t.opacity,\n          pitch: t.pitch,\n          xHeadRight: 0,\n          tiedFrom: t\n        }) : null;\n      }\n\n      analyzePitch(t, e) {\n        const i = this.getPitchDetails(t.pitch);\n        i.vSteps in this.barAccidentals ? i.accidental === this.barAccidentals[i.vSteps] ? i.accidental = 0 : (3 === this.barAccidentals[i.vSteps] ? i.accidental = i.keyAccidental : 0 === i.accidental && (i.accidental = 3), this.barAccidentals[i.vSteps] = i.accidental) : (t.tiedFrom && (i.accidental = 0), this.barAccidentals[i.vSteps] = i.accidental), t.vSteps = i.vSteps, t.accidental = i.accidental;\n      }\n\n      getPitchDetails(t) {\n        const e = t - 60,\n              i = Math.floor(e / 12),\n              s = e - 12 * i,\n              n = a[this.key].steps[s],\n              r = 71 === this.clef ? 6 : -6,\n              l = 1 === h[this.key].accidental ? 69 + (s + 3) % 12 : 64 + (s + 8) % 12;\n        return {\n          vSteps: r - 7 * i + n,\n          accidental: a[this.key].accidental[s],\n          keyAccidental: h[this.key].pitches.indexOf(l) > -1 ? h[this.key].accidental : 0\n        };\n      }\n\n    }\n  }, function (t, e, i) {\n    \"use strict\";\n\n    i.r(e);\n    var s = i(3);\n    i.d(e, \"MAX_QUARTER_DIVISION\", function () {\n      return s.MAX_QUARTER_DIVISION;\n    }), i.d(e, \"ScrollType\", function () {\n      return s.ScrollType;\n    }), i.d(e, \"StaffSVGRender\", function () {\n      return s.StaffSVGRender;\n    });\n  }]);\n});","map":null,"metadata":{},"sourceType":"script"}